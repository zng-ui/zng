[package]
name = "zng-view"
version = "0.6.5"
authors = ["The Zng Project Developers"]
edition = "2021"
license = "Apache-2.0 OR MIT"
readme = "README.md"
description = "Part of the zng project."
documentation = "https://zng-ui.github.io/doc/zng_view"
repository = "https://github.com/zng-ui/zng"
categories = ["gui"]
keywords = ["gui", "ui", "user-interface", "zng"]

[features]
default = ["ipc", "software"]

# Enables pre-build and init as view-process.
#
# If this is enabled all communication with the view is serialized/deserialized, 
# even in same-process mode.
#
# Only enables in `cfg(not(target_os = "android"))` builds.
ipc = ["zng-view-api/ipc"]

# Enables software renderer fallback.
#
# If enabled and a native OpenGL 3.2 driver is not available the `swgl` software renderer is used.
software = ["dep:swgl", "dep:softbuffer"]

# Bundle third party licenses.
#
# Needs `cargo-about` and Internet connection during build.
#
# Not enabled by default. Note that `"view_prebuilt"` always bundles licenses.
bundle_licenses = ["zng-tp-licenses/bundle"]

# Enable AVIF decoder and encoder.
#
# Note that this enables the `dav1d` dependency that is not trivial to build.
#
# Removed for now because there is no way to exclude this feature from test runs that use --all-features
#
# Also see `docs/avif-setup.md` for a guide on how to depend on zng-view with avif.
# avif = ["image/avif", "image/avif-native"]

# Standard Android backend that requires a build system that can compile Java or Kotlin and fetch Android dependencies.
#
# See `https://docs.rs/winit/latest/winit/platform/android/` for more details.
android_game_activity = ["winit/android-game-activity"]

# Basic Android backend that does not require Java.
#
# See `https://docs.rs/winit/latest/winit/platform/android/` for more details. 
android_native_activity = ["winit/android-native-activity"]

[lib]
crate-type = ["lib", "cdylib"]

[dependencies]
webrender = { package = "zng-webrender", version = "0.64.1" }
swgl = { package = "zng-swgl", version = "0.3.1", optional = true }

zng-view-api = { path = "../zng-view-api", version = "0.10.5", default-features = false }
zng-unit = { path = "../zng-unit", version = "0.2.10" }
zng-txt = { path = "../zng-txt", version = "0.2.8" }
zng-tp-licenses = { path = "../zng-tp-licenses", version = "0.2.9" }
zng-env = { path = "../zng-env", version = "0.3.7" }

# `view_process_extension!` uses pre-expanded code generated by linkme macro that must match link_section name.
linkme = "=0.3.28"

tracing = "0.1"
gleam = "0.15.0" # matches webrender
winit = { version = "0.30", default-features = false, features = [
    "x11",
    "wayland",
    "wayland-dlopen",
    "rwh_06",
] }
glutin = "0.32"
raw-window-handle = "0.6" # matches glutin
flume = "0.11"
image = { version = "0.25", default-features = false, features = [
    "rayon",
    "bmp",
    "dds",
    "exr",
    "ff",
    "gif",
    "hdr",
    "ico",
    "jpeg",
    "png",
    "pnm",
    "qoi",
    "tga",
    "tiff",
    "webp",
] }
img-parts = "0.3"
byteorder = "1.5"
rustc-hash = "2.0"
rayon = "1.10"
serde = "1.0"
accesskit = "0.17"
accesskit_winit = "0.23"
# rfd
## cfg(not(linux, android, ios))
[target.'cfg(not(any(target_os = "linux", target_os = "dragonfly", target_os = "freebsd", target_os = "netbsd", target_os = "openbsd", target_os = "android", target_os = "ios")))'.dependencies.rfd]
version = "0.15"
default-features = false
## cfg(linux)
[target.'cfg(any(target_os = "linux", target_os = "dragonfly", target_os = "freebsd", target_os = "netbsd", target_os = "openbsd"))'.dependencies.rfd]
version = "0.15"
default-features = false
features = ["xdg-portal", "async-std"]

[target.'cfg(windows)'.dependencies.windows-sys]
version = "0.52.0" # matches winit, glutin, other crates
features = [
    "Win32_UI_Shell",
    "Win32_System_Com",
    "Win32_UI_WindowsAndMessaging",
    "Win32_Devices_HumanInterfaceDevice",
    "Win32_UI_Input_KeyboardAndMouse",
    "Win32_Graphics_Gdi",
    "Win32_Graphics_OpenGL",
    "Win32_UI_Accessibility",
    "Win32_System_LibraryLoader",
    "Win32_Globalization",
    "Win32_System_SystemServices",
    "Win32_System_Power",
    "Win32_System_Shutdown",
]
[target.'cfg(windows)'.dependencies.windows]
version = "0.58.0"
features = ["Foundation_Collections", "System_UserProfile", "UI_ViewManagement"]

[target.'cfg(windows)'.dependencies]
clipboard-win = { version = "5.0", features = ["std"] }

[target.'cfg(not(any(windows, target_os = "android")))'.dependencies]
arboard = "3.3"
[target.'cfg(not(windows))'.dependencies]
sys-locale = "0.3"

[target.'cfg(any(target_os = "linux", target_os = "dragonfly", target_os = "freebsd", target_os = "netbsd", target_os = "openbsd"))'.dependencies]
wayland-client = { version = "0.31", default-features = false } # matches winit
x11-dl = "2.18.5"                                               # matches winit
tempfile = "3.10"
# xlib is re-exported by glutin/winit

[target.'cfg(target_os = "macos")'.dependencies.objc2-app-kit]
version = "0.2.2"
features = ["NSEvent", "NSAppearance", "NSColor", "NSColorSpace"]
[target.'cfg(target_os = "macos")'.dependencies.objc2-foundation]
version = "0.2.2"
features = ["NSString"]

[target.'cfg(target_os = "android")'.dependencies]
parking_lot = "0.12"
# matches winit -> android-activity
ndk = { version = "0.9.0", default-features = false }
ndk-context = "0.1.1"
jni = "0.21"

[target.'cfg(not(target_os = "android"))'.dependencies]
softbuffer = { version = "0.4", optional = true }

[build-dependencies]
zng-tp-licenses = { path = "../zng-tp-licenses", version = "0.2.9", features = [
    "build",
] }
cfg_aliases = "0.2"

[lints.rust]
unexpected_cfgs = { level = "warn", check-cfg = ['cfg(feature, values("avif"))', 'cfg(zng_view_image_has_avif)'] }

[package.metadata.docs.rs]
all-features = true
targets = [
    "x86_64-unknown-linux-gnu",
    "x86_64-pc-windows-msvc",
    "x86_64-apple-darwin",
]

# prebuild profile defined in the workspace toml
